<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP-MED | ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .bg-purple-up { background-color: #602D91; }
        .text-gold-up { color: #FDB813; }
    </style>
</head>
<body class="bg-gray-100 flex min-h-screen">

    <nav class="w-64 bg-purple-up text-white shadow-xl flex-shrink-0">
        <div class="p-8 text-center border-b border-purple-800">
            <h1 class="text-3xl font-bold text-gold-up">UP-MED</h1>
            <p class="text-xs opacity-60 mt-1">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå (Online)</p>
        </div>
        <div class="p-4 space-y-2">
            <button onclick="changePage('db')" id="btn-db" class="w-full text-left p-4 rounded-xl bg-white/20 font-bold transition">üìä Dashboard</button>
            <button onclick="changePage('in')" id="btn-in" class="w-full text-left p-4 rounded-xl hover:bg-white/10 transition">üì¶ ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏¢‡∏≤</button>
        </div>
    </nav>

    <main class="flex-1 p-8 overflow-x-hidden">
        <div class="flex justify-between items-center mb-8">
            <input type="text" id="search" onkeyup="render()" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤..." class="px-6 py-3 w-80 rounded-2xl border-none shadow-sm outline-none focus:ring-2 focus:ring-purple-600">
            <button onclick="addMed()" class="bg-[#FDB813] text-[#602D91] px-6 py-3 rounded-2xl font-bold shadow-md hover:scale-105 transition">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤</button>
        </div>

        <div id="page-db">
            <div class="grid grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-3xl shadow-sm border-l-8 border-[#602D91]"><p class="text-gray-400 text-sm">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p><h2 id="stat-total" class="text-3xl font-bold text-[#602D91]">0</h2></div>
                <div class="bg-white p-6 rounded-3xl shadow-sm border-l-8 border-blue-400"><p class="text-gray-400 text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô/PO</p><h2 id="stat-plan" class="text-3xl font-bold text-blue-500">0</h2></div>
                <div class="bg-white p-6 rounded-3xl shadow-sm border-l-8 border-orange-400"><p class="text-gray-400 text-sm">‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡πà‡∏á/‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö</p><h2 id="stat-wait" class="text-3xl font-bold text-orange-500">0</h2></div>
                <div class="bg-white p-6 rounded-3xl shadow-sm border-l-8 border-green-500"><p class="text-gray-400 text-sm">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p><h2 id="stat-done" class="text-3xl font-bold text-green-600">0</h2></div>
            </div>
            
            <div class="bg-white rounded-3xl shadow-sm p-6 overflow-hidden">
                <h3 class="font-bold mb-4 text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                <table class="w-full text-left border-collapse">
                    <thead class="text-gray-400 border-b text-sm">
                        <tr>
                            <th class="pb-4">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå</th>
                            <th class="pb-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th>
                            <th class="pb-4">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</th>
                        </tr>
                    </thead>
                    <tbody id="table-db" class="divide-y"></tbody>
                </table>
            </div>
        </div>

        <div id="page-in" class="hidden">
            <div class="bg-white rounded-3xl shadow-sm overflow-x-auto">
                <table class="w-full text-left min-w-[800px]">
                    <thead class="bg-gray-50 border-b text-sm">
                        <tr>
                            <th class="p-4 text-gray-600">‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤</th>
                            <th class="p-4 text-gray-600">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏±‡∏™‡∏î‡∏∏</th>
                            <th class="p-4 text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏°‡∏≤‡∏ñ‡∏∂‡∏á</th>
                            <th class="p-4 text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á</th>
                            <th class="p-4 text-gray-600 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="table-in" class="divide-y"></tbody>
                </table>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAmt2szWOjQBPfzfs7QfQVysgfaRzHyPa0",
            authDomain: "up-med-online.firebaseapp.com",
            databaseURL: "https://up-med-online-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "up-med-online",
            storageBucket: "up-med-online.appspot.com",
            messagingSenderId: "381838942970",
            appId: "1:381838942970:web:8f83a02ba1544d54a95f43",
            measurementId: "G-2BFLRT47F1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const medsRef = ref(db, 'meds');

        window.meds = [];
        const statusList = ["‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô", "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÉ‡∏ö", "‡∏à‡∏±‡∏î‡∏ó‡∏≥ PO", "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏™‡πà‡∏á‡∏¢‡∏≤", "‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö", "‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß"];

        // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Realtime
        onValue(medsRef, (snapshot) => {
            const data = snapshot.val();
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï window.meds
            window.meds = data ? (Array.isArray(data) ? data : Object.values(data)) : [];
            window.render(); 
        });

        // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô)
        window.saveToCloud = (data) => {
            // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ã‡∏ü‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à
            if (data && Array.isArray(data)) {
                set(medsRef, data);
            }
        };

        window.addMed = () => {
            const name = prompt("‡∏õ‡πâ‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤/‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå:");
            if(name && name.trim() !== "") {
                const newMed = {
                    id: Date.now(),
                    name: name,
                    status: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô',
                    arrivalDate: '',
                    receivedDate: ''
                };
                // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤ ‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà
                window.saveToCloud([newMed, ...window.meds]);
            }
        };

        window.delMed = (id) => {
            if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?")) {
                const updated = window.meds.filter(m => m.id !== id);
                window.saveToCloud(updated);
            }
        };

        window.updateField = (id, field, value) => {
            const updated = window.meds.map(m => m.id === id ? {...m, [field]: value} : m);
            window.saveToCloud(updated);
        };

        window.changePage = (page) => {
            document.getElementById('page-db').classList.toggle('hidden', page !== 'db');
            document.getElementById('page-in').classList.toggle('hidden', page !== 'in');
            document.getElementById('btn-db').classList.toggle('bg-white/20', page === 'db');
            document.getElementById('btn-in').classList.toggle('bg-white/20', page === 'in');
        };

        window.render = () => {
            const q = document.getElementById('search').value.toLowerCase();
            const filtered = window.meds.filter(m => m.name.toLowerCase().includes(q));

            // Stats
            document.getElementById('stat-total').innerText = window.meds.length;
            document.getElementById('stat-plan').innerText = window.meds.filter(m => m.status.includes('‡∏à‡∏±‡∏î‡∏ó‡∏≥')).length;
            document.getElementById('stat-wait').innerText = window.meds.filter(m => m.status === '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏™‡πà‡∏á‡∏¢‡∏≤' || m.status === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö').length;
            document.getElementById('stat-done').innerText = window.meds.filter(m => m.status === '‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß').length;

            // Table Dashboard
            document.getElementById('table-db').innerHTML = filtered.map(m => `
                <tr>
                    <td class="py-4 font-bold text-purple-900">${m.name}</td>
                    <td class="py-4">
                        <span class="px-3 py-1 rounded-full text-xs font-bold ${m.status === '‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß' ? 'bg-green-100 text-green-600' : 'bg-orange-100 text-orange-500'}">
                            ${m.status}
                        </span>
                    </td>
                    <td class="py-4 text-gray-500 text-sm">${m.receivedDate || '-'}</td>
                </tr>
            `).join('');

            // Table Input
            document.getElementById('table-in').innerHTML = filtered.map(m => `
                <tr class="hover:bg-gray-50 transition">
                    <td class="p-4 font-bold text-gray-700">${m.name}</td>
                    <td class="p-4">
                        <select onchange="window.updateField(${m.id}, 'status', this.value)" class="bg-white border border-gray-200 p-2 rounded-lg text-sm outline-none">
                            ${statusList.map(s => `<option value="${s}" ${m.status===s?'selected':''}>${s}</option>`).join('')}
                        </select>
                    </td>
                    <td class="p-4">
                        <input type="date" value="${m.arrivalDate}" onchange="window.updateField(${m.id}, 'arrivalDate', this.value)" class="bg-gray-50 border border-gray-200 p-1 rounded text-sm">
                    </td>
                    <td class="p-4">
                        <input type="date" value="${m.receivedDate}" onchange="window.updateField(${m.id}, 'receivedDate', this.value)" class="bg-gray-50 border border-gray-200 p-1 rounded text-sm">
                    </td>
                    <td class="p-4 text-center">
                        <button onclick="window.delMed(${m.id})" class="text-red-300 hover:text-red-600">üóëÔ∏è ‡∏•‡∏ö</button>
                    </td>
                </tr>
            `).join('');
        };
    </script>
</body>
</html>