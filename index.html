<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP Hospital Inventory | ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå ‡∏£‡∏û.‡∏°‡∏û.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700;800&display=swap');
        :root { --up-purple: #602D91; --up-gold: #FDB813; }
        body { font-family: 'Sarabun', sans-serif; background-color: #F1F5F9; color: #1E293B; }
        .bg-up-purple { background-color: var(--up-purple); }
        .text-up-purple { color: var(--up-purple); }
        .text-up-gold { color: var(--up-gold); }
        
        @media (max-width: 1024px) {
            nav { position: fixed; left: -100%; z-index: 1000; transition: 0.4s; }
            nav.active { left: 0; }
            .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 900; backdrop-filter: blur(4px); }
            .overlay.active { display: block; }
        }

        .med-card { background: white; border-radius: 2rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03); transition: all 0.3s; }
        .up-progress-bg { height: 10px; background: #E2E8F0; border-radius: 10px; overflow: hidden; }
        .up-progress-fill { height: 100%; border-radius: 10px; background: linear-gradient(90deg, var(--up-purple), #8B5CF6); transition: width 1s; }
        .bg-done { background: linear-gradient(90deg, #10B981, #34D399) !important; }
        .status-pill { padding: 6px 14px; border-radius: 12px; font-size: 11px; font-weight: 800; display: inline-flex; align-items: center; white-space: nowrap; }
        .hidden-page { display: none; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-active { background: var(--up-purple); color: white; box-shadow: 0 8px 15px rgba(96, 45, 145, 0.2); }
        .tab-inactive { background: white; color: #64748B; border: 1px solid #E2E8F0; }
    </style>
</head>
<body class="flex min-h-screen flex-col lg:flex-row">

    <div id="toast" class="fixed bottom-10 right-5 left-5 lg:left-auto lg:right-10 z-[2000] hidden bg-slate-900 text-white px-8 py-5 rounded-[2rem] shadow-2xl items-center border border-white/10 justify-center">
        <span id="toast-icon" class="mr-3 text-xl">‚úÖ</span>
        <span id="toast-msg" class="font-bold text-sm">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span>
    </div>

    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <header class="lg:hidden bg-up-purple text-white p-4 flex justify-between items-center sticky top-0 z-[800] shadow-lg">
        <div class="flex items-center gap-3">
            <div class="bg-white p-1 rounded-lg"><img src="images.png" class="w-7 h-7 object-contain"></div>
            <span class="font-black text-sm tracking-wider uppercase">UP Hospital</span>
        </div>
        <button onclick="toggleMenu()" class="text-2xl p-2">‚ò∞</button>
    </header>

    <nav id="sidebar" class="w-72 bg-up-purple text-white h-screen flex flex-col shadow-2xl shrink-0">
        <div class="p-10 text-center border-b border-white/10 hidden lg:block">
            <div class="w-28 h-28 bg-white rounded-[2.5rem] mx-auto mb-6 flex items-center justify-center shadow-2xl border-b-8 border-up-gold overflow-hidden">
                <img src="images.png" alt="UP Logo" class="w-20 h-20 object-contain">
            </div>
            <h1 class="text-2xl font-black tracking-tight">UP HOSPITAL</h1>
            <p class="text-[11px] text-up-gold font-black uppercase tracking-[0.2em] mt-1">‡∏Ñ‡∏•‡∏±‡∏á‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏Å‡∏•‡∏≤‡∏á</p>
        </div>
        <div class="p-6 space-y-3 flex-1">
            <button onclick="changePage('db')" id="btn-db" class="w-full flex items-center p-4 rounded-2xl bg-white/20 font-bold transition-all">
                <span class="mr-4 text-xl">üè•</span> Dashboard
            </button>
            <button onclick="changePage('in')" id="btn-in" class="w-full flex items-center p-4 rounded-2xl hover:bg-white/10 transition-all opacity-60 font-bold">
                <span class="mr-4 text-xl">üì¶</span> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å
            </button>
        </div>
    </nav>

    <main class="flex-1 p-4 lg:p-12 overflow-x-hidden">
        <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-8">
            <div class="relative w-full max-w-md">
                <input type="text" id="search" onkeyup="render()" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå..." class="w-full pl-12 pr-6 py-4 rounded-[1.5rem] border-none shadow-sm focus:ring-4 focus:ring-purple-100 outline-none transition-all bg-white">
                <span class="absolute left-4 top-4 text-xl opacity-30">üîç</span>
            </div>
            <button onclick="openModal()" class="w-full md:w-auto bg-up-purple text-white px-8 py-4 rounded-[1.5rem] font-extrabold shadow-lg hover:scale-105 active:scale-95 transition-all">
                + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>

        <div id="page-db" class="fade-in space-y-6">
            <div class="grid grid-cols-2 lg:grid-cols-5 gap-4">
                <div onclick="changePage('in'); setFilter('all')" class="bg-white p-4 rounded-[1.5rem] shadow-sm border-b-4 border-up-purple text-center cursor-pointer hover:bg-purple-50 transition-all">
                    <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                    <h2 id="stat-total" class="text-3xl font-black text-slate-800">0</h2>
                </div>
                <div onclick="changePage('in'); setFilter('plan')" class="bg-white p-4 rounded-[1.5rem] shadow-sm border-b-4 border-blue-400 text-center cursor-pointer hover:bg-blue-50 transition-all">
                    <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1">‡πÅ‡∏ú‡∏ô‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠</p>
                    <h2 id="stat-plan" class="text-3xl font-black text-blue-500">0</h2>
                </div>
                <div onclick="changePage('in'); setFilter('wait')" class="bg-white p-4 rounded-[1.5rem] shadow-sm border-b-4 border-up-gold text-center cursor-pointer hover:bg-yellow-50 transition-all">
                    <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö</p>
                    <h2 id="stat-wait" class="text-3xl font-black text-up-gold">0</h2>
                </div>
                <div onclick="changePage('in'); setFilter('done')" class="bg-white p-4 rounded-[1.5rem] shadow-sm border-b-4 border-emerald-500 text-center cursor-pointer hover:bg-emerald-50 transition-all">
                    <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1">‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á</p>
                    <h2 id="stat-done" class="text-3xl font-black text-emerald-500">0</h2>
                </div>
                <div onclick="changePage('in'); setFilter('low')" class="bg-red-50 p-4 rounded-[1.5rem] shadow-sm border-b-4 border-red-500 text-center cursor-pointer hover:bg-red-100 transition-all col-span-2 lg:col-span-1">
                    <p class="text-[9px] font-black text-red-400 uppercase tracking-widest mb-1">‡∏¢‡∏≠‡∏î‡∏¢‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</p>
                    <h2 class="text-3xl font-black text-red-600">‚ö†Ô∏è</h2> 
                </div>
            </div>

            <div class="bg-white p-6 lg:p-10 rounded-[2.5rem] shadow-sm border border-slate-100">
                <h3 class="text-xl font-black mb-6 flex items-center">
                    <span class="w-1.5 h-6 bg-up-purple rounded-full mr-3"></span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                </h3>
                <div class="overflow-x-auto">
                    <table class="w-full min-w-[700px]">
                        <thead class="text-left text-[10px] font-black text-slate-400 uppercase border-b border-slate-50">
                            <tr>
                                <th class="pb-4 px-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå</th>
                                <th class="pb-4">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</th>
                                <th class="pb-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th class="pb-4">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                <th class="pb-4 text-right pr-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</th>
                            </tr>
                        </thead>
                        <tbody id="table-db" class="divide-y divide-slate-50"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="page-in" class="hidden-page fade-in">
            <div class="flex flex-wrap gap-2 mb-8 bg-slate-200/50 p-1.5 rounded-[1.5rem] w-full lg:w-fit">
                <button onclick="setFilter('all')" id="tab-all" class="flex-1 lg:flex-none px-6 py-3 rounded-full font-black text-[10px] tab-active">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button onclick="setFilter('plan')" id="tab-plan" class="flex-1 lg:flex-none px-6 py-3 rounded-full font-black text-[10px] tab-inactive">‡πÅ‡∏ú‡∏ô‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠ üìã</button>
                <button onclick="setFilter('wait')" id="tab-wait" class="flex-1 lg:flex-none px-6 py-3 rounded-full font-black text-[10px] tab-inactive">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö ‚è≥</button>
                <button onclick="setFilter('low')" id="tab-low" class="flex-1 lg:flex-none px-6 py-3 rounded-full font-black text-[10px] tab-inactive">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î ‚ö†Ô∏è</button>
                <button onclick="setFilter('done')" id="tab-done" class="flex-1 lg:flex-none px-6 py-3 rounded-full font-black text-[10px] tab-inactive">‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß ‚ú®</button>
            </div>
            <div id="table-in" class="grid grid-cols-1 gap-6"></div>
        </div>
    </main>

    <div id="medModal" class="fixed inset-0 bg-up-purple/40 backdrop-blur-md z-[2000] hidden items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-10 shadow-2xl">
            <h2 class="text-2xl font-black mb-6 text-up-purple">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå</h2>
            <div class="space-y-4">
                <input type="text" id="newMedName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå" class="w-full p-4 bg-slate-50 rounded-xl border-none outline-none font-bold">
                <input type="number" id="newMedStock" value="0" class="w-full p-4 bg-slate-50 rounded-xl border-none outline-none font-bold">
                <div class="flex gap-3 pt-4">
                    <button onclick="closeModal()" class="flex-1 py-4 font-bold text-slate-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button onclick="saveNewMed()" class="flex-[2] py-4 bg-up-purple text-white rounded-xl font-black shadow-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAmt2szWOjQBPfzfs7QfQVysgfaRzHyPa0",
            authDomain: "up-med-online.firebaseapp.com",
            databaseURL: "https://up-med-online-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "up-med-online",
            storageBucket: "up-med-online.appspot.com",
            messagingSenderId: "381838942970",
            appId: "1:381838942970:web:8f83a02ba1544d54a95f43"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const medsRef = ref(db, 'meds');

        window.meds = [];
        window.filterIn = 'all';
        const statusList = ["‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô", "‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÉ‡∏ö‡∏Ç‡∏≠‡∏ã‡∏∑‡πâ‡∏≠", "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ PO", "‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå", "‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö", "‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß"];

        window.toggleMenu = () => {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        };

        window.setFilter = (f) => { window.filterIn = f; render(); }

        window.showToast = (msg) => {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.style.display = 'flex';
            setTimeout(() => toast.style.display = 'none', 3000);
        };

        window.openModal = () => document.getElementById('medModal').classList.remove('hidden');
        window.closeModal = () => {
            document.getElementById('medModal').classList.add('hidden');
            document.getElementById('newMedName').value = '';
            document.getElementById('newMedStock').value = '0';
        };

        window.saveNewMed = () => {
            const name = document.getElementById('newMedName').value;
            const stock = parseInt(document.getElementById('newMedStock').value) || 0;
            if(name) {
                const id = Date.now();
                set(ref(db, 'meds/' + id), { id, name, stock, status: '‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô', arrivalDate: '', receivedDate: '' });
                closeModal();
                showToast("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            }
        };

        onValue(medsRef, (snapshot) => {
            const data = snapshot.val();
            window.meds = data ? Object.keys(data).map(k => data[k]) : [];
            window.render();
        });

        window.updateField = (id, field, value) => {
            const item = window.meds.find(m => m.id == id);
            if(item) {
                item[field] = (field === 'stock') ? parseInt(value) : value;
                set(ref(db, 'meds/' + id), item);
                showToast("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß");
            }
        };

        window.delMed = (id) => { if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) set(ref(db, 'meds/' + id), null); };

        window.changePage = (page) => {
            document.getElementById('page-db').className = page === 'db' ? 'fade-in space-y-6' : 'hidden-page';
            document.getElementById('page-in').className = page === 'in' ? 'fade-in' : 'hidden-page';
            document.getElementById('btn-db').classList.toggle('bg-white/20', page === 'db');
            document.getElementById('btn-in').classList.toggle('bg-white/20', page === 'in');
            if (window.innerWidth < 1024) {
                document.getElementById('sidebar').classList.remove('active');
                document.getElementById('overlay').classList.remove('active');
            }
        };

        window.render = () => {
            const q = document.getElementById('search').value.toLowerCase();
            const today = new Date().toISOString().split('T')[0];

            // 1. ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
            document.getElementById('stat-total').innerText = window.meds.length;
            document.getElementById('stat-plan').innerText = window.meds.filter(m => m.status.includes('‡∏à‡∏±‡∏î‡∏ó‡∏≥')).length;
            document.getElementById('stat-wait').innerText = window.meds.filter(m => m.status === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö').length;
            document.getElementById('stat-done').innerText = window.meds.filter(m => m.status === '‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß').length;

            // 2. Dashboard Table
            const todayItems = window.meds.filter(m => m.receivedDate === today);
            document.getElementById('table-db').innerHTML = todayItems.map(m => {
                const idx = statusList.indexOf(m.status);
                const pct = ((idx + 1) / statusList.length) * 100;
                return `<tr class="border-b border-slate-50 text-sm">
                    <td class="py-5 px-2"><b>${m.name}</b></td>
                    <td class="py-5 w-40"><div class="up-progress-bg"><div class="up-progress-fill ${pct==100?'bg-done':''}" style="width:${pct}%"></div></div></td>
                    <td class="py-5"><span class="status-pill bg-purple-50 text-purple-600">${m.status}</span></td>
                    <td class="py-5"><b>${m.stock}</b></td>
                    <td class="py-5 text-right pr-4 text-emerald-600 font-bold">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</td>
                </tr>`;
            }).join('') || '<tr><td colspan="5" class="py-10 text-center text-slate-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</td></tr>';

            // 3. Inventory Logic ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            let filteredIn = window.meds.filter(m => m.name.toLowerCase().includes(q));
            if (window.filterIn === 'low') filteredIn = filteredIn.filter(m => m.stock < 10);
            else if (window.filterIn === 'done') filteredIn = filteredIn.filter(m => m.status === '‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß');
            else if (window.filterIn === 'plan') filteredIn = filteredIn.filter(m => m.status.includes('‡∏à‡∏±‡∏î‡∏ó‡∏≥'));
            else if (window.filterIn === 'wait') filteredIn = filteredIn.filter(m => m.status === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö');

            // Update Tab UI
            ['all', 'plan', 'wait', 'low', 'done'].forEach(t => {
                const btn = document.getElementById('tab-' + t);
                if(btn) btn.className = `flex-1 lg:flex-none px-6 py-3 rounded-full font-black text-[10px] ${window.filterIn === t ? 'tab-active' : 'tab-inactive'}`;
            });

            document.getElementById('table-in').innerHTML = filteredIn.map(m => {
                const currentStep = statusList.indexOf(m.status) + 1;
                return `<div class="med-card p-6 border border-slate-100">
                    <div class="flex flex-col lg:flex-row justify-between gap-4">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-slate-100 text-2xl">${m.stock < 10 ? '‚ö†Ô∏è' : 'üì¶'}</div>
                            <div><h4 class="font-black">${m.name}</h4><p class="text-xs text-slate-400">${m.status}</p></div>
                        </div>
                        <div class="flex gap-2 items-end flex-wrap lg:flex-nowrap">
                            <select onchange="window.updateField(${m.id}, 'status', this.value)" class="flex-1 bg-white border rounded p-2 text-xs font-bold">
                                ${statusList.map(s => `<option value="${s}" ${m.status===s?'selected':''}>${s}</option>`).join('')}
                            </select>
                            <input type="number" value="${m.stock}" onchange="window.updateField(${m.id}, 'stock', this.value)" class="w-20 border rounded p-2 text-xs font-bold">
                            <input type="date" value="${m.receivedDate}" onchange="window.updateField(${m.id}, 'receivedDate', this.value)" class="border rounded p-2 text-xs font-bold">
                            <button onclick="window.delMed(${m.id})" class="p-2.5 bg-red-50 text-red-500 rounded-lg">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>`;
            }).join('') || '<div class="text-center py-20 opacity-30">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>';
        };
    </script>
</body>
</html>