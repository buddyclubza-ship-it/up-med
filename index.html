<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP-MED | ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; scroll-behavior: smooth; }
        .bg-purple-up { background-color: #602D91; }
        .text-gold-up { color: #FDB813; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .hidden-page { display: none; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-[#F8FAFC] flex min-h-screen">

    <nav class="w-64 bg-purple-up text-white shadow-2xl flex-shrink-0 z-50 sticky top-0 h-screen">
        <div class="p-8 text-center border-b border-purple-800">
            <h1 class="text-4xl font-black text-gold-up tracking-tighter">UP-MED</h1>
            <div class="bg-gold-up/20 text-gold-up text-[10px] px-2 py-1 rounded-full mt-2 inline-block font-bold">V 2.0 ONLINE</div>
        </div>
        <div class="p-6 space-y-3">
            <button onclick="changePage('db')" id="btn-db" class="w-full text-left p-4 rounded-2xl bg-white/20 font-bold transition-all flex items-center">
                <span class="mr-3 text-xl">üìä</span> Dashboard
            </button>
            <button onclick="changePage('in')" id="btn-in" class="w-full text-left p-4 rounded-2xl hover:bg-white/10 transition-all flex items-center opacity-70">
                <span class="mr-3 text-xl">üì¶</span> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å
            </button>
        </div>
        <div class="absolute bottom-10 w-64 px-8 text-[10px] opacity-40 text-center">
            &copy; 2026 UP-MED System<br>Real-time Cloud Connected
        </div>
    </nav>

    <main class="flex-1 p-10 overflow-x-hidden">
        <div class="flex justify-between items-center mb-10">
            <div class="relative group">
                <input type="text" id="search" onkeyup="render()" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå..." 
                    class="pl-12 pr-6 py-4 w-96 rounded-2xl border-none shadow-sm outline-none focus:ring-4 focus:ring-purple-200 transition-all text-gray-600 bg-white">
                <span class="absolute left-4 top-4 opacity-30 text-xl group-focus-within:opacity-100 transition-opacity">üîç</span>
            </div>
            <button onclick="addMed()" class="bg-[#FDB813] text-[#602D91] px-8 py-4 rounded-2xl font-black shadow-[0_4px_15px_rgba(253,184,19,0.4)] hover:scale-105 active:scale-95 transition-all">
                + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>

        <div id="page-db" class="fade-in">
            <div class="grid grid-cols-4 gap-6 mb-10 text-center">
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border-b-8 border-purple-600 card-hover transition-all">
                    <p class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-1">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    <h2 id="stat-total" class="text-4xl font-black text-gray-800">0</h2>
                </div>
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border-b-8 border-blue-400 card-hover transition-all">
                    <p class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-1">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡πÅ‡∏ú‡∏ô/‡πÉ‡∏ö</p>
                    <h2 id="stat-plan" class="text-4xl font-black text-blue-500">0</h2>
                </div>
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border-b-8 border-orange-400 card-hover transition-all">
                    <p class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-1">‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</p>
                    <h2 id="stat-wait" class="text-4xl font-black text-orange-500">0</h2>
                </div>
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border-b-8 border-emerald-500 card-hover transition-all">
                    <p class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-1">‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß</p>
                    <h2 id="stat-done" class="text-4xl font-black text-emerald-500">0</h2>
                </div>
            </div>
            
            <div class="bg-white rounded-[2.5rem] shadow-sm p-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                    <span class="text-xs text-purple-400 font-bold bg-purple-50 px-4 py-2 rounded-full animate-pulse">‚óè Cloud Live</span>
                </div>
                <table class="w-full text-left">
                    <thead class="text-gray-400 border-b border-gray-100 text-xs font-bold uppercase">
                        <tr>
                            <th class="pb-4 px-2">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå / ID</th>
                            <th class="pb-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th>
                            <th class="pb-4 text-right pr-4">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</th>
                        </tr>
                    </thead>
                    <tbody id="table-db" class="divide-y divide-gray-50"></tbody>
                </table>
            </div>
        </div>

        <div id="page-in" class="hidden-page fade-in">
            <div class="bg-white rounded-[2.5rem] shadow-sm overflow-hidden">
                <table class="w-full text-left min-w-[800px]">
                    <thead class="bg-gray-50/50 border-b text-xs font-bold text-gray-500 uppercase">
                        <tr>
                            <th class="p-6">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                            <th class="p-6">‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            <th class="p-6">‡∏Ç‡∏≠‡∏á‡∏°‡∏≤‡∏ñ‡∏∂‡∏á</th>
                            <th class="p-6">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á</th>
                            <th class="p-6 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="table-in" class="divide-y divide-gray-50"></tbody>
                </table>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAmt2szWOjQBPfzfs7QfQVysgfaRzHyPa0",
            authDomain: "up-med-online.firebaseapp.com",
            databaseURL: "https://up-med-online-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "up-med-online",
            storageBucket: "up-med-online.appspot.com",
            messagingSenderId: "381838942970",
            appId: "1:381838942970:web:8f83a02ba1544d54a95f43"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const medsRef = ref(db, 'meds');

        window.meds = [];
        const statusList = ["‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô", "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÉ‡∏ö", "‡∏à‡∏±‡∏î‡∏ó‡∏≥ PO", "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏™‡πà‡∏á‡∏¢‡∏≤", "‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö", "‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß"];

        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Real-time
        onValue(medsRef, (snapshot) => {
            const data = snapshot.val();
            window.meds = data ? (Array.isArray(data) ? data : Object.values(data)) : [];
            window.render(); 
        });

        window.saveToCloud = (data) => set(medsRef, data);

        window.addMed = () => {
            const name = prompt("‡∏õ‡πâ‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤/‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå:");
            if(name) {
                const newMed = { id: Date.now(), name, status: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô', arrivalDate: '', receivedDate: '' };
                window.saveToCloud([newMed, ...window.meds]);
            }
        };

        window.delMed = (id) => {
            if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) window.saveToCloud(window.meds.filter(m => m.id !== id));
        };

        window.updateField = (id, field, value) => {
            const updated = window.meds.map(m => m.id === id ? {...m, [field]: value} : m);
            window.saveToCloud(updated);
        };

        window.changePage = (page) => {
            document.getElementById('page-db').className = page === 'db' ? 'fade-in' : 'hidden-page';
            document.getElementById('page-in').className = page === 'in' ? 'fade-in' : 'hidden-page';
            document.getElementById('btn-db').classList.toggle('bg-white/20', page === 'db');
            document.getElementById('btn-in').classList.toggle('bg-white/20', page === 'in');
        };

        window.render = () => {
            const q = document.getElementById('search').value.toLowerCase();
            const filtered = window.meds.filter(m => m.name.toLowerCase().includes(q));

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
            document.getElementById('stat-total').innerText = window.meds.length;
            document.getElementById('stat-plan').innerText = window.meds.filter(m => m.status.includes('‡∏à‡∏±‡∏î‡∏ó‡∏≥')).length;
            document.getElementById('stat-wait').innerText = window.meds.filter(m => m.status === '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏™‡πà‡∏á‡∏¢‡∏≤' || m.status === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö').length;
            document.getElementById('stat-done').innerText = window.meds.filter(m => m.status === '‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß').length;

            // ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Dashboard
            document.getElementById('table-db').innerHTML = filtered.map(m => `
                <tr>
                    <td class="py-5 px-2"><b>${m.name}</b><br><span class="text-[9px] text-gray-400">ID-${m.id.toString().slice(-6)}</span></td>
                    <td class="py-5"><span class="px-3 py-1 rounded-full text-[10px] bg-blue-50 text-blue-600 font-bold">${m.status}</span></td>
                    <td class="py-5 text-right pr-4 text-gray-400 text-sm">${m.receivedDate || '-'}</td>
                </tr>
            `).join('') || '<tr><td colspan="3" class="text-center py-10 text-gray-300">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';

            // ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
            document.getElementById('table-in').innerHTML = filtered.map(m => `
                <tr class="hover:bg-purple-50">
                    <td class="p-6 font-bold">${m.name}</td>
                    <td class="p-6">
                        <select onchange="window.updateField(${m.id}, 'status', this.value)" class="border p-2 rounded-lg text-xs">
                            ${statusList.map(s => `<option value="${s}" ${m.status===s?'selected':''}>${s}</option>`).join('')}
                        </select>
                    </td>
                    <td class="p-6"><input type="date" value="${m.arrivalDate}" onchange="window.updateField(${m.id}, 'arrivalDate', this.value)" class="text-xs p-1"></td>
                    <td class="p-6"><input type="date" value="${m.receivedDate}" onchange="window.updateField(${m.id}, 'receivedDate', this.value)" class="text-xs p-1"></td>
                    <td class="p-6 text-center"><button onclick="window.delMed(${m.id})" class="text-red-400">üóëÔ∏è</button></td>
                </tr>
            `).join('') || '<tr><td colspan="5" class="text-center py-10 text-gray-300">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
        };
    </script>
</body>
</html>