<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP-MED | ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; scroll-behavior: smooth; }
        .bg-purple-up { background-color: #602D91; }
        .text-gold-up { color: #FDB813; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; }
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•‡∏Ç‡∏∂‡πâ‡∏ô */
        tr { transition: all 0.2s; }
        .hidden-page { display: none; }
    </style>
</head>
<body class="bg-[#F8FAFC] flex min-h-screen">

    <nav class="w-64 bg-purple-up text-white shadow-2xl flex-shrink-0 z-50">
        <div class="p-8 text-center border-b border-purple-800">
            <h1 class="text-4xl font-black text-gold-up tracking-tighter">UP-MED</h1>
            <div class="bg-gold-up/20 text-gold-up text-[10px] px-2 py-1 rounded-full mt-2 inline-block font-bold">V 2.0 ONLINE</div>
        </div>
        <div class="p-6 space-y-3">
            <button onclick="changePage('db')" id="btn-db" class="w-full text-left p-4 rounded-2xl bg-white/20 font-bold transition-all flex items-center">
                <span class="mr-3 text-xl">üìä</span> Dashboard
            </button>
            <button onclick="changePage('in')" id="btn-in" class="w-full text-left p-4 rounded-2xl hover:bg-white/10 transition-all flex items-center opacity-70">
                <span class="mr-3 text-xl">üì¶</span> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å
            </button>
        </div>
        <div class="absolute bottom-10 w-64 px-8 text-[10px] opacity-40 text-center">
            &copy; 2026 UP-MED System<br>Real-time Cloud Connected
        </div>
    </nav>

    <main class="flex-1 p-10 overflow-x-hidden">
        <div class="flex justify-between items-center mb-10">
            <div class="relative group">
                <input type="text" id="search" onkeyup="render()" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå..." 
                    class="pl-12 pr-6 py-4 w-96 rounded-2xl border-none shadow-sm outline-none focus:ring-4 focus:ring-purple-200 transition-all text-gray-600 bg-white">
                <span class="absolute left-4 top-4 opacity-30 text-xl group-focus-within:opacity-100 transition-opacity">üîç</span>
            </div>
            <button onclick="addMed()" class="bg-[#FDB813] text-[#602D91] px-8 py-4 rounded-2xl font-black shadow-[0_4px_15px_rgba(253,184,19,0.4)] hover:scale-105 active:scale-95 transition-all">
                + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>

        <div id="page-db" class="animate-in fade-in duration-500">
            <div class="grid grid-cols-4 gap-6 mb-10 text-center">
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border-b-8 border-purple-600 card-hover transition-all">
                    <p class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-1">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    <h2 id="stat-total" class="text-4xl font-black text-gray-800">0</h2>
                </div>
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border-b-8 border-blue-400 card-hover transition-all">
                    <p class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-1">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡πÅ‡∏ú‡∏ô</p>
                    <h2 id="stat-plan" class="text-4xl font-black text-blue-500">0</h2>
                </div>
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border-b-8 border-orange-400 card-hover transition-all">
                    <p class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-1">‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</p>
                    <h2 id="stat-wait" class="text-4xl font-black text-orange-500">0</h2>
                </div>
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border-b-8 border-emerald-500 card-hover transition-all">
                    <p class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-1">‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß</p>
                    <h2 id="stat-done" class="text-4xl font-black text-emerald-500">0</h2>
                </div>
            </div>
            
            <div class="bg-white rounded-[2.5rem] shadow-sm p-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                    <span class="text-xs text-purple-400 font-bold bg-purple-50 px-4 py-2 rounded-full">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (Live)</span>
                </div>
                <table class="w-full text-left">
                    <thead class="text-gray-400 border-b border-gray-100 text-xs font-bold uppercase">
                        <tr>
                            <th class="pb-4 px-2">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå / ID</th>
                            <th class="pb-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th>
                            <th class="pb-4">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á</th>
                        </tr>
                    </thead>
                    <tbody id="table-db" class="divide-y divide-gray-50"></tbody>
                </table>
            </div>
        </div>

        <div id="page-in" class="hidden-page">
            <div class="bg-white rounded-[2.5rem] shadow-sm overflow-hidden">
                <table class="w-full text-left min-w-[800px]">
                    <thead class="bg-gray-50/50 border-b text-xs font-bold text-gray-500 uppercase">
                        <tr>
                            <th class="p-6">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                            <th class="p-6">‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            <th class="p-6">‡∏Ç‡∏≠‡∏á‡∏°‡∏≤‡∏ñ‡∏∂‡∏á</th>
                            <th class="p-6">‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á</th>
                            <th class="p-6 text-center">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</th>
                        </tr>
                    </thead>
                    <tbody id="table-in" class="divide-y divide-gray-50"></tbody>
                </table>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAmt2szWOjQBPfzfs7QfQVysgfaRzHyPa0",
            authDomain: "up-med-online.firebaseapp.com",
            databaseURL: "https://up-med-online-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "up-med-online",
            storageBucket: "up-med-online.appspot.com",
            messagingSenderId: "381838942970",
            appId: "1:381838942970:web:8f83a02ba1544d54a95f43",
            measurementId: "G-2BFLRT47F1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const medsRef = ref(db, 'meds');

        window.meds = [];
        const statusList = ["‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô", "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÉ‡∏ö", "‡∏à‡∏±‡∏î‡∏ó‡∏≥ PO", "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏™‡πà‡∏á‡∏¢‡∏≤", "‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö", "‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß"];

        onValue(medsRef, (snapshot) => {
            const data = snapshot.val();
            window.meds = data ? (Array.isArray(data) ? data : Object.values(data)) : [];
            window.render(); 
        });

        window.saveToCloud = (data) => {
            if (data && Array.isArray(data)) set(medsRef, data);
        };

        window.addMed = () => {
            const name = prompt("‡∏õ‡πâ‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤/‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå:");
            if(name && name.trim() !== "") {
                const newMed = {
                    id: Date.now(),
                    name: name,
                    status: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô',
                    arrivalDate: '',
                    receivedDate: ''
                };
                window.saveToCloud([newMed, ...window.meds]);
            }
        };

        window.delMed = (id) => {
            if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) {
                const updated = window.meds.filter(m => m.id !== id);
                window.saveToCloud(updated);
            }
        };

        window.updateField = (id, field, value) => {
            const updated = window.meds.map(m => m.id === id ? {...m, [field]: value} : m);
            window.saveToCloud(updated);
        };

        window.changePage = (page